<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Realm Architect & Battle Lab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
        }
        h1, h2, h3, .fantasy-font {
            font-family: 'Cinzel', serif;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b; 
        }
        ::-webkit-scrollbar-thumb {
            background: #475569; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b; 
        }

        /* Coin Flip Animation */
        .coin-container {
            perspective: 1000px;
        }
        .coin {
            width: 140px;
            height: 140px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 1.5s cubic-bezier(0.4, 2.5, 0.55, 0.5); 
        }
        .coin div {
            width: 100%;
            height: 100%;
            position: absolute;
            backface-visibility: hidden;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            box-shadow: 0 0 25px rgba(234, 179, 8, 0.6);
            border: 6px solid #fef08a;
            background-size: cover;
        }
        .side-heads {
            background: radial-gradient(circle at 30% 30%, #fbbf24, #d97706);
            color: #451a03;
            text-shadow: 0 2px 0 rgba(255,255,255,0.4);
        }
        .side-tails {
            background: radial-gradient(circle at 30% 30%, #94a3b8, #475569);
            transform: rotateY(180deg);
            color: #0f172a;
            text-shadow: 0 2px 0 rgba(255,255,255,0.4);
        }
        
        /* Loading Animation for AI */
        .ai-loading {
            position: relative;
            overflow: hidden;
        }
        .ai-loading::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 1.5s infinite;
        }
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
    </style>
</head>
<body class="min-h-screen bg-slate-900 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]">

    <!-- Header -->
    <header class="bg-slate-800 border-b border-slate-700 sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <i class="fa-solid fa-dragon text-yellow-500 text-2xl"></i>
                <div class="flex flex-col">
                    <h1 class="text-2xl font-bold text-yellow-500 tracking-wider leading-none">Realm Architect</h1>
                    <span class="text-[10px] text-slate-400 font-mono mt-1">Made by Lucas Chase and Gemini 3</span>
                </div>
            </div>
            <div class="text-sm text-slate-400 hidden md:block">
                <i class="fa-solid fa-flask text-indigo-400 mr-1"></i> Research Lab Active
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8 grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <!-- Left Column: World Builder Form (Span 2) -->
        <section class="lg:col-span-2 space-y-6">
            <div class="bg-slate-800 rounded-xl p-6 border border-slate-700 shadow-xl">
                <div class="flex items-center gap-2 mb-6 border-b border-slate-700 pb-4">
                    <i class="fa-solid fa-globe text-indigo-400 text-xl"></i>
                    <h2 class="text-xl font-bold text-white">World Base</h2>
                </div>

                <form id="worldForm" class="space-y-8">
                    
                    <!-- Section: Geography & Resources -->
                    <div class="bg-slate-700/30 p-5 rounded-lg border border-slate-600/50 relative">
                        <div class="absolute -top-3 -right-3">
                            <i class="fa-solid fa-triangle-exclamation text-yellow-500 text-2xl animate-bounce"></i>
                        </div>
                        <h3 class="text-lg font-semibold text-indigo-300 mb-4">üåç Geography & Resources</h3>
                        <p class="text-xs text-slate-400 mb-4 italic">Resources selected here determine crafting power.</p>
                        
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-2">What type of terrain does your country have?</label>
                                <select id="terrain" class="w-full bg-slate-900 border border-slate-600 rounded-md p-2 text-white text-sm">
                                    <option>Mountainous Highlands</option>
                                    <option>Dense Jungle / Rainforest</option>
                                    <option>Arid Desert / Wasteland</option>
                                    <option>Coastal Archipelago</option>
                                    <option>Frozen Tundra</option>
                                    <option>Rolling Plains & Farmland</option>
                                    <option>Subterranean Caves</option>
                                    <option>Floating Islands</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-2">What natural resources exist?</label>
                                <select id="resources" onchange="checkCraftingOptions()" class="w-full bg-slate-900 border border-slate-600 rounded-md p-2 text-white text-sm">
                                    <option value="None">Scraps & Junk</option>
                                    <option value="Metal">Precious Metals & Gems</option>
                                    <option value="Wood">Rare Timber & Flora</option>
                                    <option value="Oil">Oil & Fuel Sources</option>
                                    <option value="Mana">Magical Crystals / Mana</option>
                                    <option value="Water">Abundant Fishing / Water</option>
                                </select>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-slate-300 mb-2">What is the climate of your country?</label>
                                <select id="climate" class="w-full bg-slate-900 border border-slate-600 rounded-md p-2 text-white text-sm">
                                    <option>Tropical & Humid</option>
                                    <option>Temperate & Mild</option>
                                    <option>Harsh & Cold</option>
                                    <option>Dry & Hot</option>
                                    <option>Volcanic / Ashy</option>
                                    <option>Magically Unstable</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Section: Society -->
                    <div class="bg-slate-700/30 p-5 rounded-lg border border-slate-600/50">
                        <h3 class="text-lg font-semibold text-emerald-300 mb-4">‚öñÔ∏è Society & Structure</h3>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-2">What is the style of government?</label>
                                <select id="government" class="w-full bg-slate-900 border border-slate-600 rounded-md p-2.5 text-white text-sm">
                                    <option>Absolute Monarchy</option>
                                    <option>Democratic Republic</option>
                                    <option>Theocracy</option>
                                    <option>Military Dictatorship</option>
                                    <option>Tribal Council</option>
                                    <option>Magocracy</option>
                                    <option>Anarchy</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-2">What is the primary mode of travel?</label>
                                <select id="travel" class="w-full bg-slate-900 border border-slate-600 rounded-md p-2.5 text-white text-sm">
                                    <option>Horses & Carriages</option>
                                    <option>Ships & Boats</option>
                                    <option>Steam Trains</option>
                                    <option>Airships</option>
                                    <option>Teleportation</option>
                                    <option>Tamed Beasts</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Section: Lore & Details -->
                    <div class="bg-slate-700/30 p-5 rounded-lg border border-slate-600/50">
                        <h3 class="text-lg font-semibold text-pink-300 mb-4">üìú Lore & Details</h3>
                        <div class="grid md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-1">What is the name of your fictional country?</label>
                                <input type="text" id="countryName" class="w-full bg-slate-900 border border-slate-600 rounded-md p-2 text-white text-sm">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-1">What is the capital city called?</label>
                                <input type="text" id="capitalCity" class="w-full bg-slate-900 border border-slate-600 rounded-md p-2 text-white text-sm">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-1">What is the national language?</label>
                                <input type="text" id="language" class="w-full bg-slate-900 border border-slate-600 rounded-md p-2 text-white text-sm">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-1">What is your country‚Äôs main export?</label>
                                <input type="text" id="export" class="w-full bg-slate-900 border border-slate-600 rounded-md p-2 text-white text-sm">
                            </div>
                        </div>

                        <div class="space-y-4">
                            <div class="relative group">
                                <div class="flex justify-between items-end mb-1">
                                    <label class="block text-sm font-medium text-slate-300">Describe culture and traditions</label>
                                    <button type="button" onclick="generateText('culture')" class="text-xs bg-pink-900/30 text-pink-300 px-2 py-1 rounded border border-pink-800 hover:bg-pink-800 transition-colors flex items-center gap-1">
                                        <i class="fa-solid fa-wand-magic-sparkles"></i> Auto-Write
                                    </button>
                                </div>
                                <textarea id="culture" rows="2" class="w-full bg-slate-900 border border-slate-600 rounded-md p-2 text-white text-sm"></textarea>
                            </div>
                            
                            <div class="relative group">
                                <div class="flex justify-between items-end mb-1">
                                    <label class="block text-sm font-medium text-slate-300">Explain the history of your country</label>
                                    <button type="button" onclick="generateText('history')" class="text-xs bg-pink-900/30 text-pink-300 px-2 py-1 rounded border border-pink-800 hover:bg-pink-800 transition-colors flex items-center gap-1">
                                        <i class="fa-solid fa-wand-magic-sparkles"></i> Auto-Write
                                    </button>
                                </div>
                                <textarea id="history" rows="2" class="w-full bg-slate-900 border border-slate-600 rounded-md p-2 text-white text-sm"></textarea>
                            </div>

                            <div class="relative group">
                                <div class="flex justify-between items-end mb-1">
                                    <label class="block text-sm font-medium text-slate-300">What makes your country unique?</label>
                                    <button type="button" onclick="generateText('unique')" class="text-xs bg-pink-900/30 text-pink-300 px-2 py-1 rounded border border-pink-800 hover:bg-pink-800 transition-colors flex items-center gap-1">
                                        <i class="fa-solid fa-wand-magic-sparkles"></i> Auto-Write
                                    </button>
                                </div>
                                <textarea id="unique" rows="2" class="w-full bg-slate-900 border border-slate-600 rounded-md p-2 text-white text-sm"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- SAVE TO PLAYER SECTION -->
                    <div class="bg-indigo-900/40 p-5 rounded-lg border border-indigo-500/50">
                        <h3 class="text-lg font-bold text-white mb-2"><i class="fa-solid fa-floppy-disk mr-2"></i>Save Country to Player</h3>
                        <div class="flex gap-2">
                             <input type="text" id="architectName" placeholder="Enter Player Name (e.g., Lucas)" class="flex-grow bg-slate-900 border border-slate-600 rounded-md p-2.5 text-white">
                             <button type="button" onclick="saveWorldToPlayer()" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold px-6 rounded-md shadow-lg transition-colors">
                                 Save & Update Stats
                             </button>
                        </div>
                        <p class="text-xs text-slate-400 mt-2">This will create a new player or update an existing one with this world data.</p>
                    </div>

                    <!-- RESEARCH & CRAFTING AREA -->
                    <div class="bg-slate-900/80 p-6 rounded-xl border-2 border-indigo-500/50 shadow-[0_0_20px_rgba(99,102,241,0.2)]">
                        <h3 class="text-xl font-bold text-indigo-300 mb-4 flex items-center gap-2">
                            <i class="fa-solid fa-flask"></i> Research & Crafting Lab
                        </h3>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <!-- Research Column -->
                            <div class="bg-slate-800/50 p-4 rounded-lg border border-slate-600">
                                <h4 class="text-white font-bold mb-2"><i class="fa-solid fa-book-open-reader text-yellow-400 mr-2"></i>Research Tech</h4>
                                <p class="text-xs text-slate-400 mb-4">Spend Energy to increase your Battle Probability Modifier.</p>
                                
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm text-indigo-200">Current Tech Level:</span>
                                    <span id="displayTechLevel" class="text-xl font-bold text-white">0</span>
                                </div>

                                <div class="mb-4">
                                    <label class="block text-xs text-slate-500 mb-1">Select Researcher (Player)</label>
                                    <select id="researcherSelect" class="w-full bg-slate-900 text-white text-sm p-2 rounded border border-slate-600 mb-2">
                                        <!-- Populated via JS -->
                                    </select>
                                    <button type="button" onclick="conductResearch()" class="w-full bg-indigo-700 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded transition-colors text-sm">
                                        Research (-2 Energy)
                                    </button>
                                </div>
                            </div>

                            <!-- Crafting Column -->
                            <div class="bg-slate-800/50 p-4 rounded-lg border border-slate-600">
                                <h4 class="text-white font-bold mb-2"><i class="fa-solid fa-hammer text-red-400 mr-2"></i>Weapon Crafting</h4>
                                <p class="text-xs text-slate-400 mb-4">Type what you want to build. Requires resources.</p>
                                
                                <div id="craftingStatus" class="text-xs text-yellow-500 mb-2 h-4 font-mono"></div>

                                <div class="space-y-2">
                                    <label class="block text-xs text-slate-500">Select Crafter</label>
                                    <select id="crafterSelect" class="w-full bg-slate-900 text-white text-sm p-2 rounded border border-slate-600">
                                        <!-- Populated via JS -->
                                    </select>

                                    <label class="block text-xs text-slate-500">Schematic Name</label>
                                    <input type="text" id="schematicInput" placeholder="e.g. Iron Sword, Laser Pistol..." class="w-full bg-slate-900 text-white text-sm p-2 rounded border border-slate-600 focus:border-red-500 focus:ring-1 focus:ring-red-500 outline-none">

                                    <button type="button" onclick="craftItem()" class="w-full bg-red-800 hover:bg-red-700 text-white font-bold py-2 px-4 rounded transition-colors text-sm">
                                        Craft Weapon (-5 Energy)
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </section>

        <!-- Right Column: Battle & Tracker -->
        <aside class="space-y-6">
            
            <!-- Battle Arena -->
            <div class="bg-slate-800 rounded-xl p-1 border-2 border-yellow-600/50 shadow-2xl relative overflow-hidden">
                <div class="bg-slate-900 p-4 rounded-lg text-center">
                    <h2 class="text-2xl font-bold text-yellow-500 fantasy-font mb-1">
                        <i class="fa-solid fa-swords"></i> Luck Battle
                    </h2>
                    <p class="text-[10px] text-slate-400 uppercase tracking-widest mb-4">First to 10 Wins</p>

                    <!-- Player Selection -->
                    <div class="flex justify-between items-center mb-6 gap-2">
                        <div class="w-1/2">
                            <select id="p1Select" onchange="updateBattleOdds()" class="w-full bg-indigo-900/30 border border-indigo-500/50 text-indigo-300 text-xs p-1 rounded text-center font-bold">
                                <option value="">Select P1</option>
                            </select>
                            <div class="text-2xl font-bold text-white mt-2" id="p1Score">0</div>
                        </div>
                        <div class="text-slate-500 font-bold">VS</div>
                        <div class="w-1/2">
                            <select id="p2Select" onchange="updateBattleOdds()" class="w-full bg-red-900/30 border border-red-500/50 text-red-300 text-xs p-1 rounded text-center font-bold">
                                <option value="">Select P2</option>
                            </select>
                            <div class="text-2xl font-bold text-white mt-2" id="p2Score">0</div>
                        </div>
                    </div>

                    <!-- The Arena Coin -->
                    <div class="coin-container h-40 flex items-center justify-center mb-4">
                        <div id="coin" class="coin">
                            <div class="side-heads border-indigo-500 text-indigo-900">
                                <i class="fa-solid fa-user-astronaut"></i>
                            </div>
                            <div class="side-tails border-red-500 text-red-900">
                                <i class="fa-solid fa-skull"></i>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Odds Display -->
                    <div class="text-xs text-slate-400 mb-4" id="oddsDisplay">
                        Odds: 50% vs 50%
                    </div>

                    <div id="battleResult" class="h-6 text-sm font-bold text-yellow-400 mb-2"></div>

                    <button onclick="battleFlip()" id="battleBtn" class="w-full bg-gradient-to-r from-yellow-700 to-yellow-600 hover:from-yellow-600 hover:to-yellow-500 text-white font-bold py-3 px-8 rounded-lg shadow-lg border-b-4 border-yellow-800 active:border-b-0 active:mt-1 transition-all uppercase tracking-wider">
                        FIGHT ROUND
                    </button>
                    
                    <button onclick="resetBattle()" class="text-xs text-slate-500 mt-4 hover:text-white underline">Reset Score</button>
                </div>
            </div>

            <!-- Energy Tracker Tool -->
            <div class="bg-slate-800 rounded-xl p-6 border border-slate-700 shadow-xl relative">
                <h2 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                    <i class="fa-solid fa-bolt text-yellow-400"></i> Energy & Stats
                </h2>
                
                <div class="mb-4">
                    <div class="flex gap-2 mt-1">
                        <input type="text" id="newPlayerName" placeholder="New Player Name..." class="bg-slate-900 border border-slate-600 text-white text-sm rounded-md block w-full p-2.5">
                        <button onclick="addPlayerManually()" class="bg-green-600 hover:bg-green-700 text-white rounded-md px-3 transition-colors">
                            <i class="fa-solid fa-plus"></i>
                        </button>
                    </div>
                </div>

                <div id="playerList" class="space-y-3 max-h-[300px] overflow-y-auto pr-1">
                    <!-- Players will be injected here via JS -->
                </div>

                <div class="mt-4 pt-4 border-t border-slate-700 flex justify-between items-center">
                    <p class="text-xs text-slate-400 text-center"><i class="fa-regular fa-clock"></i> +10 Points / 24h</p>
                    <button onclick="toggleGraveyard()" class="text-xs text-red-400 hover:text-red-300 underline">View Deleted</button>
                </div>
            </div>

        </aside>
    </main>

    <!-- Graveyard Modal -->
    <div id="graveyardModal" class="fixed inset-0 z-[100] hidden flex items-center justify-center bg-slate-900/90 backdrop-blur-sm">
        <div class="bg-slate-800 rounded-xl border border-red-900 p-6 w-full max-w-md">
            <h3 class="text-xl font-bold text-red-500 mb-4"><i class="fa-solid fa-skull-crossbones mr-2"></i>The Graveyard</h3>
            <div id="graveyardList" class="space-y-2 max-h-[300px] overflow-y-auto mb-4">
                <!-- Deleted players go here -->
            </div>
            <button onclick="toggleGraveyard()" class="w-full bg-slate-700 hover:bg-slate-600 text-white py-2 rounded">Close</button>
        </div>
    </div>

    <script>
        const apiKey = "AIzaSyBfkQs-8la7NNQq5lO2g2EKXw5l87rUSOM"; // Gemini API Key

        // --- DATA MANAGEMENT ---
        let players = JSON.parse(localStorage.getItem('battlePlayers')) || [];
        let deletedPlayers = JSON.parse(localStorage.getItem('deletedPlayers')) || [];
        let scores = { p1: 0, p2: 0 };
        const formFields = [
            'terrain', 'resources', 'climate', 'government', 'travel', 
            'countryName', 'capitalCity', 'language', 'export', 
            'culture', 'history', 'unique'
        ];

        function savePlayers() {
            localStorage.setItem('battlePlayers', JSON.stringify(players));
            localStorage.setItem('deletedPlayers', JSON.stringify(deletedPlayers));
            renderPlayers();
            updateSelects();
        }

        // --- AI GENERATION ---
        function getContext() {
            return {
                terrain: document.getElementById('terrain').value,
                climate: document.getElementById('climate').value,
                government: document.getElementById('government').value,
                resources: document.getElementById('resources').value,
                name: document.getElementById('countryName').value || "Unnamed",
                travel: document.getElementById('travel').value
            };
        }

        async function generateText(fieldId) {
            const ctx = getContext();
            const textarea = document.getElementById(fieldId);
            const btn = textarea.previousElementSibling.querySelector('button');
            const originalBtnText = btn.innerHTML;
            
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Writing...';
            btn.disabled = true;

            let prompt = "";
            switch(fieldId) {
                case 'culture': prompt = `Describe culture for ${ctx.name}, ${ctx.terrain}, ${ctx.government}.`; break;
                case 'history': prompt = `Short history for ${ctx.name}, a ${ctx.government} in ${ctx.terrain}.`; break;
                case 'unique': prompt = `What makes ${ctx.name} unique? (${ctx.resources}, ${ctx.climate}).`; break;
            }

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await response.json();
                if (data.candidates) textarea.value = data.candidates[0].content.parts[0].text;
            } catch (e) {
                console.error("AI Error:", e);
                alert("AI Error. Try again.");
            } finally {
                btn.innerHTML = originalBtnText;
                btn.disabled = false;
            }
        }

        // --- PLAYER LOGIC ---
        function addPlayerManually() {
            const name = document.getElementById('newPlayerName').value.trim();
            if (!name) return;
            createOrUpdatePlayer(name);
            document.getElementById('newPlayerName').value = '';
        }

        function saveWorldToPlayer() {
            const name = document.getElementById('architectName').value.trim();
            if (!name) return alert("Enter a player name!");
            createOrUpdatePlayer(name, true);
        }

        function createOrUpdatePlayer(name, withWorldData = false) {
            let p = players.find(p => p.name.toLowerCase() === name.toLowerCase());
            
            // Check graveyard
            if (!p) {
                const deadIndex = deletedPlayers.findIndex(dp => dp.name.toLowerCase() === name.toLowerCase());
                if (deadIndex > -1) {
                    if(confirm("This player is in the Graveyard. Restore them?")) {
                        p = deletedPlayers[deadIndex];
                        deletedPlayers.splice(deadIndex, 1);
                        players.push(p);
                    } else return;
                }
            }

            if (!p) {
                p = {
                    id: Date.now(),
                    name: name,
                    energy: 10, // Starts with 10
                    techLevel: 0,
                    inventory: [],
                    lastUpdate: Date.now(),
                    worldData: null
                };
                players.push(p);
            }

            if (withWorldData) {
                let data = {};
                formFields.forEach(f => data[f] = document.getElementById(f).value);
                p.worldData = data;
                alert(`World saved to ${p.name}!`);
            }

            savePlayers();
        }

        function loadPlayerWorldData(id) {
            const player = players.find(p => p.id === id);
            if (!player) return;

            if (player.worldData) {
                formFields.forEach(field => {
                    const el = document.getElementById(field);
                    if (el && player.worldData[field] !== undefined) {
                        el.value = player.worldData[field];
                    }
                });
                document.getElementById('architectName').value = player.name;
                // Using a custom UI element or console log instead of alert()
                console.log(`Loaded world data for ${player.name}`); 
                document.getElementById('craftingStatus').innerText = `Loaded data for ${player.name}`;
            } else {
                console.warn(`${player.name} has no saved world data.`);
                document.getElementById('craftingStatus').innerText = `${player.name} has no saved world data.`;
            }
            checkCraftingOptions();
        }

        function modifyEnergy(id, amount) {
            const p = players.find(p => p.id === id);
            if (p) {
                p.energy += amount;
                savePlayers();
            }
        }

        function deletePlayer(id) {
            const idx = players.findIndex(p => p.id === id);
            if (idx > -1) {
                // Using a simple confirmation for this quick app
                if(confirm(`Are you sure you want to send ${players[idx].name} to the Graveyard?`)) { 
                    deletedPlayers.push(players[idx]);
                    players.splice(idx, 1);
                    savePlayers();
                }
            }
        }

        function restorePlayer(id) {
            const idx = deletedPlayers.findIndex(p => p.id === id);
            if (idx > -1) {
                players.push(deletedPlayers[idx]);
                deletedPlayers.splice(idx, 1);
                savePlayers();
                toggleGraveyard(); // Refresh view
            }
        }

        function toggleGraveyard() {
            const modal = document.getElementById('graveyardModal');
            const list = document.getElementById('graveyardList');
            
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                list.innerHTML = deletedPlayers.length === 0 ? '<p class="text-slate-500 text-center">Empty.</p>' : '';
                deletedPlayers.forEach(p => {
                    list.innerHTML += `
                        <div class="flex justify-between items-center bg-slate-900 p-2 rounded border border-red-900/50">
                            <span class="text-slate-400">${p.name}</span>
                            <button onclick="restorePlayer(${p.id})" class="text-xs bg-green-900 text-green-400 px-2 py-1 rounded">Restore</button>
                        </div>
                    `;
                });
            } else {
                modal.classList.add('hidden');
            }
        }

        // --- RESEARCH & CRAFTING ---
        function checkCraftingOptions() {
            const res = document.getElementById('resources').value;
            document.getElementById('craftingStatus').innerText = `Resource: ${res}`;
        }

        function conductResearch() {
            const id = parseInt(document.getElementById('researcherSelect').value);
            const player = players.find(p => p.id === id);
            if (!player) return console.warn("Select a researcher!");
            
            if (player.energy < 2) return console.warn("Not enough energy! Needs 2.");

            player.energy -= 2;
            player.techLevel += 1;
            
            document.getElementById('displayTechLevel').innerText = player.techLevel;
            savePlayers();
            updateBattleOdds(); 
        }

        function craftItem() {
            const id = parseInt(document.getElementById('crafterSelect').value);
            const itemName = document.getElementById('schematicInput').value.trim();
            const resource = document.getElementById('resources').value;
            const player = players.find(p => p.id === id);
            
            if (!player) return console.warn("Select a crafter!");
            if (!itemName) return console.warn("Enter name!");
            
            // STRICT ENERGY CHECK
            if (player.energy < 5) return console.warn("Not enough energy! Needs 5.");

            const forbiddenWords = ["god", "nuke", "nuclear", "infinite", "death star", "instant", "kill all", "invincible", "admin", "hack", "planet destroyer", "universe"];
            if (forbiddenWords.some(word => itemName.toLowerCase().includes(word))) {
                return console.warn("Too OP!");
            }

            let basePower = 1;
            if (resource === "Wood") basePower = 3;
            else if (resource === "Water") basePower = 4;
            else if (resource === "Metal") basePower = 6;
            else if (resource === "Oil") basePower = 7;
            else if (resource === "Mana") basePower = 8;
            
            const finalPower = Math.max(1, basePower + (Math.floor(Math.random() * 4) - 1));

            player.energy -= 5; // Deduct Energy
            player.inventory.push({ name: itemName, power: finalPower });
            
            console.log(`${player.name} crafted ${itemName}! (+${finalPower} Power)`);
            document.getElementById('schematicInput').value = "";
            savePlayers();
            updateBattleOdds();
        }

        function calculateMilitaryPower(player) {
            if (!player) return 0;
            let weaponPower = player.inventory.reduce((sum, item) => sum + item.power, 0);
            return (player.techLevel * 2) + weaponPower;
        }

        // --- BATTLE & RENDERING ---
        function updateSelects() {
            const p1 = document.getElementById('p1Select');
            const p2 = document.getElementById('p2Select');
            const r = document.getElementById('researcherSelect');
            const c = document.getElementById('crafterSelect');
            
            const v1 = p1.value, v2 = p2.value;
            [p1, p2, r, c].forEach(sel => sel.innerHTML = '<option value="">Select...</option>');

            players.forEach(p => {
                const opt = `<option value="${p.id}">${p.name} (Pwr: ${calculateMilitaryPower(p)})</option>`;
                p1.innerHTML += opt; p2.innerHTML += opt; r.innerHTML += opt; c.innerHTML += opt;
            });
            p1.value = v1; p2.value = v2;
        }

        function updateBattleOdds() {
            const p1Id = document.getElementById('p1Select').value;
            const p2Id = document.getElementById('p2Select').value;
            if (!p1Id || !p2Id) return document.getElementById('oddsDisplay').innerText = "Select players.";

            const p1 = players.find(p => p.id == p1Id);
            const p2 = players.find(p => p.id == p2Id);
            const pow1 = calculateMilitaryPower(p1);
            const pow2 = calculateMilitaryPower(p2);

            let p1Chance = 50 + ((pow1 - pow2) * 2);
            if (p1Chance > 90) p1Chance = 90;
            if (p1Chance < 10) p1Chance = 10;

            document.getElementById('oddsDisplay').innerText = `${p1.name} Win Chance: ${p1Chance}% | ${p2.name}: ${100-p1Chance}%`;
            return p1Chance;
        }

        function renderPlayers() {
            const container = document.getElementById('playerList');
            container.innerHTML = '';

            players.forEach(player => {
                // Regen Logic (24h = 86400000ms)
                const now = Date.now();
                if (now - player.lastUpdate >= 86400000) {
                    player.energy += 10;
                    player.lastUpdate = now;
                    savePlayers();
                }

                const power = calculateMilitaryPower(player);
                const items = player.inventory.length > 0 ? player.inventory.map(i => i.name).join(", ") : "None";
                const hasWorld = player.worldData ? '<i class="fa-solid fa-earth-americas text-indigo-400 ml-1"></i>' : '';

                const div = document.createElement('div');
                div.className = 'bg-slate-700/50 p-3 rounded-lg flex flex-col gap-2 border border-slate-600';
                div.innerHTML = `
                    <div class="flex justify-between items-center">
                        <!-- Clickable Player Name -->
                        <span onclick="loadPlayerWorldData(${player.id})" class="font-bold text-white cursor-pointer hover:text-indigo-400 transition-colors">${player.name} ${hasWorld}</span>
                        <div class="flex items-center gap-2">
                             <button onclick="modifyEnergy(${player.id}, -1)" class="text-xs bg-slate-800 text-slate-300 px-1.5 rounded hover:bg-slate-700">-</button>
                             <span class="text-xs text-yellow-500 font-mono w-6 text-center">${player.energy}</span>
                             <button onclick="modifyEnergy(${player.id}, 1)" class="text-xs bg-slate-800 text-slate-300 px-1.5 rounded hover:bg-slate-700">+</button>
                             <button onclick="deletePlayer(${player.id})" class="ml-2 text-slate-500 hover:text-red-400"><i class="fa-solid fa-trash"></i></button>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-2 text-xs text-slate-300 bg-slate-800/50 p-2 rounded">
                        <div>Tech Lvl: <span class="text-white font-bold">${player.techLevel}</span></div>
                        <div>Mil. Power: <span class="text-red-400 font-bold">${power}</span></div>
                    </div>
                    <div class="text-[10px] text-slate-400 truncate">Inventory: ${items}</div>
                `;
                container.appendChild(div);
            });
        }

        let currentRotation = 0;
        let isBattling = false;
        function battleFlip() {
            if (isBattling) return;
            const p1Id = document.getElementById('p1Select').value;
            const p2Id = document.getElementById('p2Select').value;
            if (!p1Id || !p2Id || p1Id === p2Id) return console.warn("Select 2 different players!");
            if (scores.p1 >= 10 || scores.p2 >= 10) return console.warn("Reset Score!");

            isBattling = true;
            const winChanceP1 = updateBattleOdds();
            const p1Wins = (Math.random() * 100) <= winChanceP1;

            const coin = document.getElementById('coin');
            document.getElementById('battleResult').innerText = "";
            document.getElementById('battleBtn').disabled = true;

            currentRotation += 1800;
            const rem = currentRotation % 360;
            if (p1Wins) { if (rem !== 0) currentRotation += (360 - rem); }
            else { if (rem !== 180) currentRotation += (180 - rem + 360) % 360; }

            coin.style.transform = `rotateY(${currentRotation}deg)`;

            setTimeout(() => {
                if (p1Wins) scores.p1++; else scores.p2++;
                document.getElementById('p1Score').innerText = scores.p1;
                document.getElementById('p2Score').innerText = scores.p2;
                
                const p1Name = players.find(p => p.id == p1Id).name;
                const p2Name = players.find(p => p.id == p2Id).name;
                const res = document.getElementById('battleResult');
                
                res.innerText = p1Wins ? `${p1Name} Wins!` : `${p2Name} Wins!`;
                res.className = p1Wins ? "h-6 text-sm font-bold text-indigo-400 mb-2" : "h-6 text-sm font-bold text-red-400 mb-2";

                if (scores.p1 >= 10 || scores.p2 >= 10) console.log("BATTLE OVER!");
                isBattling = false;
                document.getElementById('battleBtn').disabled = false;
            }, 1500);
        }

        function resetBattle() {
            scores = { p1: 0, p2: 0 };
            document.getElementById('p1Score').innerText = 0;
            document.getElementById('p2Score').innerText = 0;
            document.getElementById('battleResult').innerText = "";
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderPlayers();
            updateSelects();
            checkCraftingOptions();
        });
    </script>
</body>
</html>
